---
// В этой секции (frontmatter) пока ничего не нужно, но она должна быть
---

<div class="flex justify-center mb-12">
    <div class="tabs" id="calculator-mode-toggle">
        <span class="glider"></span>
        <button class="tab-btn active" data-target="host-calculator-content">
            <i class="fas fa-glass-cheers mr-2"></i>Ведущий
        </button>
        <button class="tab-btn" data-target="rap-calculator-content">
            <i class="fas fa-microphone-alt mr-2"></i>Рэп-исполнитель
        </button>
    </div>
</div>

<style>
    @import "../../styles/tabs.css";
</style>

<script is:inline>
    document.addEventListener("DOMContentLoaded", () => {
        const tabsContainer = document.getElementById("calculator-mode-toggle");
        if (!tabsContainer) return;

        const tabs = tabsContainer.querySelectorAll(".tab-btn");
        const glider = tabsContainer.querySelector(".glider");
        const contentPanels = document.querySelectorAll(".content-panel");

        function updateGlider() {
            const activeTab = tabsContainer.querySelector(".tab-btn.active");
            if (!glider || !activeTab) return;

            const isMobile = window.innerWidth <= 640;

            if (isMobile) {
                glider.style.width = "calc(100% - 10px)";
                glider.style.left = "5px";
                glider.style.height = `${activeTab.offsetHeight}px`;
                glider.style.top = `${activeTab.offsetTop}px`;
            } else {
                glider.style.height = "calc(100% - 10px)";
                glider.style.top = "5px";
                glider.style.width = `${activeTab.offsetWidth}px`;
                glider.style.left = `${activeTab.offsetLeft}px`;
            }
        }

        function switchTab(targetTab) {
            const targetId = targetTab.dataset.target;

            // 1. Update Active Classes
            tabs.forEach((tab) => tab.classList.remove("active"));
            contentPanels.forEach((panel) => panel.classList.remove("active"));
            targetTab.classList.add("active");

            const targetPanel = document.getElementById(targetId);
            if (targetPanel) {
                targetPanel.classList.add("active");
            }

            // 2. Update Glider
            updateGlider();

            // 3. Rap Mode Color Logic
            if (targetId === "rap-calculator-content") {
                tabsContainer.classList.add("rap-mode");
            } else {
                tabsContainer.classList.remove("rap-mode");
            }

            // 4. Dispatch Event
            document.dispatchEvent(
                new CustomEvent("calculatorModeChanged", {
                    detail: { mode: targetId },
                }),
            );
        }

        // Event Listeners
        tabs.forEach((tab) => {
            tab.addEventListener("click", () => switchTab(tab));
        });

        // Initialization
        const initialActiveTab = tabsContainer.querySelector(".tab-btn.active");
        if (initialActiveTab) {
            // Initial render
            updateGlider();
        }

        window.addEventListener("resize", updateGlider);
        setTimeout(updateGlider, 100);
    });
</script>
